<!DOCTYPE html>
<html>
  <head>
    <title>Airtable Record Count</title>
  </head>
  <body>
    <h2>Total Records in Airtable</h2>
    <h1 id="count">Loading...</h1>

    <div id="result"></div>

    <script>
      const BASE_ID = "appDe178p7M9yfTub";
      const TABLE_NAME = "Executives";
      const TOKEN =
        "pat3Bzs2EBZD2Gxjl.2c0bd7cabdaa9c67ac330f9894f8f873d9952d62820e1064ad99ab46bed3f742";

      let totalCount = 0;
      let offset = "";
      let allRecords = [];

      function getRecords() {
        let url = "https://api.airtable.com/v0/" + BASE_ID + "/" + TABLE_NAME;

        if (offset !== "") {
          url = url + "?offset=" + offset;
        }

        fetch(url, {
          headers: {
            Authorization: "Bearer " + TOKEN,
          },
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (data) {
            console.log(data);
            totalCount += data.records.length;
            for (let i = 0; i < data.records.length; i++) {
              allRecords.push(data.records[i]);
            }

            // allRecords = allRecords.concat(data.records);

            if (data.offset) {
              offset = data.offset;
              getRecords();
            } else {
              document.getElementById("count").innerHTML = totalCount;

              let display = "";

              for (let i = 0; i < allRecords.length; i++) {
                display = display + "<h4>Record " + (i + 1) + "</h4>";
                let fields = allRecords[i].fields;
                for (let key in fields) {
                  display =
                    display + "<p>" + key + " : " + fields[key] + "</p>";
                }
              }

              document.getElementById("result").innerHTML = display;
            }
          })
          .catch((error) => console.log("Error:", error));
      }

      getRecords();
    </script>
  </body>
</html>
