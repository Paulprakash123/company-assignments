<!-- <!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <select id="select">
      <option value="">Select Executive</option>
    </select>
    <table border="1">
      <thead>
        <tr id="tableHead"></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    <script>
      const URL = "https://aqofyinhguapqaklzflp.supabase.co/rest/v1/leads";
      const APIKEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxb2Z5aW5oZ3VhcHFha2x6ZmxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NzM0MDYsImV4cCI6MjA3ODE0OTQwNn0.FZ1kviVvCWR2k0geZE-lm0BT9ybn8C9mp3uQb2gIMns";

      function executives() {
        fetch(URL + "?select=Executive", {
          headers: {
            apikey: APIKEY,
            Authorization: "Bearer " + APIKEY,
          },
        })
          .then((res) => res.json())
          .then((data) => {
            const dropdown = document.getElementById("select");
            const unique = new Set();

            data.forEach((item) => {
              if (item.Executive && !unique.has(item.Executive)) {
                unique.add(item.Executive);

                const option = document.createElement("option");
                option.value = item.Executive;
                option.textContent = item.Executive;
                dropdown.appendChild(option);
              }
            });
          });
      }

      function table(url) {
        fetch(url, {
          headers: {
            apikey: APIKEY,
            Authorization: "Bearer " + APIKEY,
          },
        })
          .then((res) => res.json())
          .then((data) => {
            const head = document.getElementById("tableHead");
            const body = document.getElementById("tableBody");

            head.innerHTML = "";
            body.innerHTML = "";

            if (data.length === 0) {
              body.innerHTML = "<tr><td colspan='10'>No data found</td></tr>";
              return;
            }

            // Table Head
            Object.keys(data[0]).forEach((key) => {
              const th = document.createElement("th");
              th.textContent = key;
              head.appendChild(th);
            });

            // Table Body
            data.forEach((row) => {
              const tr = document.createElement("tr");
              Object.values(row).forEach((value) => {
                const td = document.createElement("td");
                td.textContent = value;
                tr.appendChild(td);
              });
              body.appendChild(tr);
            });
          });
      }

      function final() {
        const exec = document.getElementById("select").value;
        let query = URL + "?select=*";

        if (exec !== "") {
          query += "&Executive=eq." + encodeURIComponent(exec);
        }

        table(query);
      }

      document.getElementById("select").addEventListener("change", final);

      executives();
      table(URL + "?select=*&limit=100");
    </script>
  </body>
</html> -->
<!doctype html>
<html>
  <head>
    <title>Beginner Leads Filter</title>
  </head>
  <body>
    <h3>Select Executive</h3>

    <select id="select">
      <option value="">All Executives</option>
    </select>

    <table border="1">
      <thead>
        <tr>
          <th>ID</th>
          <th>CustomerName</th>
          <th>Executive</th>
          <th>ExecutivePhone</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <script>
      const URL = "https://aqofyinhguapqaklzflp.supabase.co/rest/v1/leads";
      const APIKEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxb2Z5aW5oZ3VhcHFha2x6ZmxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NzM0MDYsImV4cCI6MjA3ODE0OTQwNn0.FZ1kviVvCWR2k0geZE-lm0BT9ybn8C9mp3uQb2gIMns";

      let allData = [];
      let executives = [];
      function check() {
        fetch(URL + "?select=*&limit=1000", {
          headers: {
            apikey: APIKEY,
            Authorization: "Bearer " + APIKEY,
          },
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (data) {
            console.log(data);
            allData = data;

            Dropdown(data);
            showTable(data);
          });
      }

      function Dropdown(data) {
        let select = document.getElementById("select");

        data.forEach(function (item) {
          if (!executives.includes(item.Executive)) {
            executives.push(item.Executive);

            let option = document.createElement("option");
            option.value = item.Executive;
            option.textContent = item.Executive;

            select.appendChild(option);
          }
        });
      }

      function showTable(data) {
        let body = document.getElementById("tableBody");
        body.innerHTML = "";

        data.forEach(function (item) {
          let row = document.createElement("tr");

          row.innerHTML =
            "<td>" +
            item.id +
            "</td>" +
            "<td>" +
            item.CustomerName +
            "</td>" +
            "<td>" +
            item.Executive +
            "</td>" +
            "<td>" +
            item.ExecutivePhone +
            "</td>";

          body.appendChild(row);
        });
      }

      document.getElementById("select").addEventListener("change", function () {
        let selected = document.getElementById("select").value;

        if (selected === "") {
          showTable(allData);
        } else {
          let final = [];

          allData.forEach(function (item) {
            if (item.Executive === selected) {
              final.push(item);
            }
          });

          showTable(final);
        }
      });
      check();
    </script>
  </body>
</html>
